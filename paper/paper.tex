%\documentclass[sigconf,anonymous,review]{acmart}
\documentclass[pageno]{jpaper}

%replace XXX with the submission number you are given from the ASPLOS submission site.
\newcommand{\asplossubmissionnumber}{39}

\usepackage[normalem]{ulem}
\usepackage{amssymb}
\usepackage{amsmath}
\usepackage{algorithm} % environment for the algorithm code (like figure and table)
\usepackage{algorithmicx} % write the pseudo code
\usepackage[noend]{algpseudocode} % layout of the pseudo code
\usepackage{tikz} % needed for: tikz pics
\usepackage{xcolor}
\usepackage{xspace}
\usepackage{natbib}
\usepackage{tikz}
\usepackage{listings}

%\usepackage{graphicx}
%\usepackage{subfigure}
%\usepackage[inline]{enumitem}

\newcommand{\TODO}[1]{{\bf \em \textcolor{red}{TODO: #1}\xspace}}
\newcommand{\todo}[2]{\textcolor{red}{$\bullet$ \textbf{Task:} #1; \textbf{Responsible:} #2}}
\newcommand{\sys}{VIPE\xspace}
\newcommand{\sysfull}{Virtualized Intermittently-Powered Execution\xspace}
\newcommand{\sysfullalt}{Virtualized Intermittently-Powered Execution Runtime\xspace}

%\setcopyright{rightsretained}

%\acmDOI{http://dx.doi.org/xx.xxxx/xxxxxxx.xxxxxxx}

%\acmISBN{978-1-xxxx-xxxx-x/17/11}

%\acmConference[ASPLOS]{The 23rd ACM International Conference on Architectural Support for Programming Languages and Operating Systems}{March 24--28, 2017}{Williamsburg, VA, USA}

%\acmYear{2017}

%\copyrightyear{2017}

%\acmPrice{15.00}

\begin{document}

\title{\sysfull \\ OR \\ \sysfullalt}

%Note: order of authors placed randomly

%\author{Kiwan Maeng}
%\authornote{}
%\orcid{}
%\affiliation{%
%	\institution{Carnegie Mellon University}
%	\streetaddress{4720 Forbes Avenue}
%\city{Pittsburgh} 
%	\state{PA} 
%	\postcode{15213}
%}
%\email{kmaeng@andrew.cmu.edu}

%\author{Alexei Colin}
%\authornote{}
%\orcid{}
%\affiliation{%
%	\institution{Carnegie Mellon University}
%	\streetaddress{4720 Forbes Avenue}
%	\city{Pittsburgh} 
%	\state{PA} 
%	\postcode{15213}
%}
%\email{acolin@andrew.cmu.edu}

%\author{Brandon Lucia}
%\authornote{}
%\orcid{}
%\affiliation{%
%	\institution{Carnegie Mellon University}
%	\streetaddress{4720 Forbes Avenue}
%	\city{Pittsburgh} 
%	\state{PA} 
%	\postcode{15213}
%}
%\email{blucia@andrew.cmu.edu}

%\author{Amjad Yousef Majid}
%\authornote{}
%\orcid{}
%\affiliation{%
%	\institution{Delft University of Technology}
%	\streetaddress{Mekelweg 4}
%	\city{Delft, The Netherlands} 
%	\state{Zuid Holland} 
%	\postcode{2628\,CD}
%}
%\email{a.y.majid@tudelft.nl}

%\author{Kas{\i}m Sinan Y{\i}ld{\i}r{\i}m}
%\authornote{}
%\orcid{}
%\affiliation{%
%	\institution{Delft University of Technology}
%	\streetaddress{Mekelweg 4}
%	\city{Delft, The Netherlands} 
%	\state{Zuid Holland} 
%	\postcode{2628\,CD}
%}
%\email{k.s.yildirim@tudelft.nl}

%\author{Przemys{\l}aw Pawe{\l}czak}
%\authornote{}
%\orcid{}
%\affiliation{%
%	\institution{Delft University of Technology}
%	\streetaddress{Mekelweg 4}
%	\city{Delft, The Netherlands} 
%	\state{Zuid Holland} 
%	\postcode{2628\,CD}
%}
%\email{p.pawelczak@tudelft.nl}

%\renewcommand{\shortauthors}{A. Y. Majid et al.}

\date{}
\maketitle

\thispagestyle{empty}

\begin{abstract}
\input{abstract}
\end{abstract}

% The code below should be generated by the tool at 
%http://dl.acm.org/ccs.cfm Please copy and paste the code instead of the 
%example below. 

%\begin{CCSXML}
%	<ccs2012>
%	<concept>
%	<concept_id>10010520.10010553.10010562.10010564</concept_id>
%	<concept_desc>Computer systems organization~Embedded 
%	software</concept_desc>
%	<concept_significance>500</concept_significance>
%	</concept>
%	<concept>
%	<concept_id>10010520.10010575.10010578</concept_id>
%	<concept_desc>Computer systems organization~Availability</concept_desc>
%	<concept_significance>300</concept_significance>
%	</concept>
%	<concept>
%	<concept_id>10011007.10010940.10010941.10010949.10010957.10010688</concept_id>
%	<concept_desc>Software and its engineering~Scheduling</concept_desc>
%	<concept_significance>300</concept_significance>
%	</concept>
%	<concept>
%	<concept_id>10011007.10010940.10010941.10010949.10010965</concept_id>
%	<concept_desc>Software and its engineering~Communications 
%	management</concept_desc>
%	<concept_significance>300</concept_significance>
%	</concept>
%	<concept>
%	<concept_id>10011007.10010940.10010971.10010564</concept_id>
%	<concept_desc>Software and its engineering~Embedded 
%	software</concept_desc>
%	<concept_significance>300</concept_significance>
%	</concept>
%	</ccs2012>
%\end{CCSXML}

%\ccsdesc[500]{Computer systems organization~Embedded software}
%\ccsdesc[300]{Computer systems organization~Availability}
%\ccsdesc[300]{Software and its engineering~Scheduling}
%\ccsdesc[300]{Software and its engineering~Communications management}
%\ccsdesc[300]{Software and its engineering~Embedded software}

%\keywords{Energy harvesting, transient operation, operating system}

\section{Introduction}
\label{sec:intro}

%\TODO{VIPER: Virtualised Intermittent Programming model, Execution model, and Runtime environment}
%\TODO{PREVIEW: Programming and Runtime Environment with Virtualised Intermittent Execution Windows}

\input{intro}

\section{Intermittent Computation: Background}
\label{sec:background}

\input{background}


\section{\sysfull}
\label{sec:overeall_system}

\begin{figure}
	\centering
	%\includegraphics[width=0.25\columnwidth]{figures/}
	\caption{\sys top-level description.}
	\label{fig:}
\end{figure}

Describe the overall system, the programming model, and the semantics/execution model. This should include a discussion of memory virtualization and task coalescing.

\section{Compiler Support for Automatic Task Generation}
\label{sec:compiler}

\input{compiler}

\section{Memory Virtualization}
\label{sec:memory_virtulaization}

\input{paging}

\begin{figure}
	\centering
	%\includegraphics[width=0.25\columnwidth]{figures/}
	\caption{Memory virtualization architecture.}
	\label{fig:}
\end{figure}

\section{Task Coalescing}
\label{sec:memory_virtulaization}

\begin{figure}
	\centering
	%\includegraphics[width=0.25\columnwidth]{figures/}
	\caption{Task coalescing architecture.}
	\label{fig:}
\end{figure}

\section{Discussion}
\label{sec:discussion}

\section{Methodology and Evaluation}
\label{sec:methodology_evaluation}

\section{Related Work}
\label{sec:related_work}

\section{Conclusions}
\label{sec:conclusions}

This paper presented \sys: \sysfull.

%%%%%Old part of the paper - will be successfully moved section by section to a final one%%%%%

\newpage

\section{Old Introduction}


% Energy source

% The intermittent execution is cumulative discrete process. The intermittent execution model is only able to execute a few number of instructions, as compared to the conventional (continuous) model, before its progress is terminated. Therefore, the intermittent execution model adapts an execution progress state saving mechanism. This mechanism is realized either by means of a checkpoint~\cite{}, where all the context of the program is saved into non-volatile memory. Or 

% This progress state saving mechanism is normally injected into a program either by a compiler~\cite{}. A compiler injects trigger pointers to checkpoint (save) the context of the program into the non-volatile memory.  or it is added by a programmer~\cite{chain}. [compare these two approaches]...

% We define virtualization within the context of intermittent execution as utilizing the volatile memory instead of non-volatile when the intermittent execution model attempts to access the non-volatile memory. 

\subsection{Why not Adapting Current Approaches}

Here we highlight the challenges of adapting the state-of-the-art proposed methods to enable the execution of dynamic task sizes. 

%	\begin{figure}[t]
%	    \centering
%	         \subfigure[Chain: Sequential task execution flow control.]{\includegraphics[width=0.35\columnwidth]{figures/dynamic-chain.pdf} \label{fig:DynamicChainSeq} } 
%	         \subfigure[Chain: Random task execution flow control.]{\includegraphics[width=0.61\columnwidth]{figures/dynamic-chain-2.pdf} \label{fig:DynamicChainRan}}
%	    \caption{Task flow control of Chain}
%	    \label{fig:DynamicChain}
%	\end{figure}

\noindent\textbf{Chain: Tasks and Channels for Reliable Intermittent Programs } \\
Some of the main problems in modifying Chain to support dynamic task's size are:

\noindent\textbf{Alpaca: Intermittent Execution without Checkpoints} \\
Some of the main problems in modifying Alpaca to support dynamic task's size are:

\noindent\textbf{Virtualizing Modular Intermittent Execution Model}

		An Intermittently executed program, as seen by the modular intermittent execution model, is a chain of tasks with a firm transition from one to another. 
		Virtualizing this model means softening a number of transitions, by keeping the state of the execution progress in the volatile memory, to construct a bigger \emph{virtual task} to reduce energy consumption. Ideally, the size of the virtual task should match the length of a continuous interval of the intermittent power supply for the best performance. Another form of virtualization can be achieved by reducing the number of non-volatile memory accesses. This can be done by having a temporary copy of a global variable in the volatile memory (similar to the catching principle) and a task interacts with it and updates it before writing back the most recent value to the non-volatile memory during the commit process.

		In this paper we are introducing \sys a runtime library the implement the Virtualed Intermittent Execution Model. \sys adapts two methods for data protection. One relies on a virtual buffer and the other uses the Direct Memory Access (DMA). \sys is able to approach the optimal tasks devision during the runtime. \sys reduces an application execution time by XX and the energy by XX. 


\subsection{Contributions}
	 \begin{enumerate}
		 \item We have developed an algorithm that is able to determine the size of a virtual task based on the history of the execution of an application. 
		 \item We enable efficient code portability by requiring that a real task to small and merging them during the execution.   
	\end{enumerate}

\section{\sysfull}
\sys is runtime library that facilitates tasks navigation and preserves data/memory consistency of the IPDs. It is able, on-demand, to merge tasks to reduce the number of commits to the non-volatile memory.

\input{iposDataProtection}

\subsection{\sys: The Virtualizing Engine}
\subsubsection{Power Interrupt Immune Scheduler}
It utilizes a persistent circular buffer (persistent linked-list) to keep the state of a program across power failures. \sys provides an API to enable a programmer to have a full control over the execution flow of the program, i.e. (un)blocking a task or re-execute the same task which is particularly important in the intermittent execution to emulate a persistent loop. 

\subsubsection{Task Merging Algorithms}

\paragraph{Fixed Virtual Task Size} [better name needed]

	\begin{algorithm}[t]
		\caption{Fixed virtual Task size}
		\label{algo:fixVirtTask}
		\scriptsize
		%\small
		\begin{algorithmic}[1]
			\State $VT \subset \text{\{\sys Tasks\}} $  \Comment{$VT:$ Virtual Task}
			\State VTS : VT size
			\State MVTS: maximum VT size
			\vspace{0.1cm}

			\While {$True$}
				\State $VT \leftarrow VT_{next}$
				\vspace{0.1cm}
				\While {execute $VT$} 
					\If { $\text{power failed twice}$ }				
							\State $VTS--$  
							\State $ MVTS = VTS $
						\EndIf
				\EndWhile

				\vspace{0.1cm}
				\If {$ \text{All tasks executed}$}
					\If{$VTS < MVTS$}
					\State $VTS++$
					\EndIf
				\EndIf
			\EndWhile
		\end{algorithmic}
	\end{algorithm}


	\begin{algorithm}[t]
		\caption{Opportunistic virtual Task size}
		\label{algo:fixVirtTask}
		\scriptsize
		%\small
		\begin{algorithmic}[1]
			\State $VT \subset \text{\{\sys Tasks\}} $  \Comment{$VT:$ Virtual Task}
			\State VTS : VT size
			\vspace{0.1cm}

			\While {$True$}
				\State $VT \leftarrow VT_{next}$
				\vspace{0.1cm}
				\While {execute $VT$} 
					\If { $\text{power failed twice}$ }				
							\State $VTS--$  
						\EndIf
				\EndWhile

				\vspace{0.1cm}
				\If {$ \text{All tasks executed}$}
					\State $VTS++$
				\EndIf
			\EndWhile
		\end{algorithmic}
	\end{algorithm}

\begin{figure}[t]
	\centering
	\includegraphics[width=0.8\columnwidth]{figures/virtualTaskSize.eps}
	\caption{Size of the virtual task versus the execution time of a dummy application that contains 12 empty tasks.}
	\label{fig:virtualTaskSize}
\end{figure}

\sys is able to virtually merge tasks to construct a bigger virtual task and commit the state of the virtual task instead of the individual real tasks. 
Fig.~\ref{fig:virtualTaskSize} show the benefit of virtualizing the Modular Intermittent Execution Mode (MIEM) in the best case scenario (continuous power supply). 

Remark: A less obvious benefit of visualization is that it can enable a secure computation. By increasing the size of the virtual task, the energy in the super-capacitor will not be enough to finish the execution of the virtual task. Therefore, without the interrogator being close to the intermittently powered device and charging rate is not negligible as compared to the discharging rate this computation will not be finished. As such, virtualization can add a layer of security to the computation.

\section{Results}
We compare the performance of \sys against a state-of-the-art intermittent execution approach. For this purpose, we used two different applications: (i) A data decompression application, which utilizes Huffman decoding technique to decompress 100 byte of data.; (ii) A discrete Fourier transform (DFT) application that uses two different resolution (4 and 8 bites) to analyze a randomly generated signal. 

\subsection{Continuous Power Supply}

\begin{figure}[t]
	\centering
	\includegraphics[width=0.8\columnwidth]{figures/chain_vipe}
	\caption{Time to complation of \sys versus Chain. Decomp: Data decompression application. DFTx: Discrete Fourier Transform.}
	\label{fig:IPOSPerformance}
\end{figure}

Fig.~\ref{fig:IPOSPerformance} shows that \sys requires a shorter execution time to execute an application under the MIEM. The size of the virtual task that \sys uses equals One real task, in other words, no visualization is applied.



\subsection{Intermittent Power Supply}
...

\bibliographystyle{plain}
\bibliography{bib}

\end{document}
