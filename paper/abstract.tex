%Old version of abstarct

%Massively deployed Internet of Things (IoT) must be energy neutral. This can only be achieved when the IoT is battery-free and the energy to operate the IoT comes from ambient energy sources. However, relying on the highly varying, unpredictable and intermittent harvested energy is at odds with the core assumption that program executions require stable and uninterrupted energy supply. The core programming model for the intermittently-powered computation is a discrete-like one that alternates between progressing and protecting the execution progress against power interrupts. Generally, intermittent computation models can be classified into (i) checkpointing, where the volatile state of a program is frequently saved to non-volatile memory, or (ii) task-based programming, where a programmer splits the code into small idempotent sections. Despite the superiority of task-based systems over checkpointing, task-based programming is completely oblivious to the energy conditions. Simply, it cannot increase or decrease the size of the task on the fly (the moment of commit to the non-volatile memory) depending on how long the energy burst is. To address this challenge, this paper introduces \sys, an \emph{adaptive} task-based execution model that does not require any dedicated hardware to support task adaptability, which at the same time is \emph{efficient}. \sys programs tune the frequency of switching between computation progressing and program state protection based on the available energy, taking the burden of finding the right computation/protection period off the programmer's shoulders. \sys defaults to progress on a multi-tasks scale, when energy permits (\emph{efficiency}), and on a sub-task scale when needed (\emph{guarantee}). Furthermore, \sys's \emph{memory virtualization} gains \sys full data protection against runtime triggered and compile-time defined memory accesses. Results show that \sys is more efficient than the current state-of-art execution model by up to a factor of two and able to progress where its counterparts fail.

%Alexei's version of abstract

Embedded devices in the Internet of Things (IoT) gain new deployment opportunities when their hardware is free of batteries and powered by ambient energy. Energy harvested from the environment, however, is unpredictable and can only power a device intermittently. In the intermittent execution model, computation is frequently interrupted by power failures, and to make forward progress, the system must save intermediate program state into non-volatile memory. Task-based programming models that execute at the granularity of statically-defined tasks, offer an efficient alternative to checkpointing. Existing task-based systems, however, fix their task size at compile time and operate without any regard to the changing energy conditions at runtime. When tasks are sized without accounting for available energy, state may be persisted either more frequently than necessary or not frequently enough for the program to make progress and terminate. To address these challenges, we propose \sys, an \emph{adaptive} task-based execution model that progresses on a multi-tasks scale, when energy permits (\emph{efficiency}), and preserves the computation progress on a sub-task scale when needed. \sys ensures that power failures cannot leave the program state in non-volatile memory inconsistent using a specialized memory virtualization mechanism. Our evaluation on a real energy-harvesting device demonstrates the benefits of adaptive task coalescing and downscaling, and highlights \sys's performance improvements over a state-of-art task-based system.